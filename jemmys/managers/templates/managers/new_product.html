{% extends "base_mgrs.html" %}
{% load staticfiles %}

{% block title_block %}
    Add a New Product | Jemmy's Collection
{% endblock title_block %}

{% block body_block %}
  <div style="margin: 0 5%;">
    <div id="new_product" class="card">
        <h3 class="m-0">Add a New Product</h3>
        <hr>
        <form method="post" enctype="multipart/form-data">
            <div id="upload_images" class="mb-1">
                <div class="flex flex-xy-center" onclick="clickInput()">
                    <svg viewBox="0 -65 512 512" style="height:5em;" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="m428.242188 34.117188h-58.921876v-23.109376c0-6.078124 4.929688-11.007812 11.007813-11.007812h36.910156c6.078125 0 11.003907 4.929688 11.003907 11.007812zm0 0"
                            fill="#618baa" />
                        <path
                            d="m151.441406 23.664062v38.519532h-102.949218v-38.519532c0-6.074218 4.933593-11.007812 11.007812-11.007812h80.9375c6.074219 0 11.003906 4.933594 11.003906 11.007812zm0 0"
                            fill="#e3f4ff" />
                        <path d="m48.492188 37.234375h102.949218v24.949219h-102.949218zm0 0" fill="#bddff4" />
                        <path
                            d="m450.257812 62.183594h-102.949218v-23.113282c0-6.078124 4.929687-11.003906 11.007812-11.003906h80.933594c6.078125 0 11.007812 4.925782 11.007812 11.003906zm0 0"
                            fill="#38627c" />
                        <path
                            d="m221.882812 62.183594h-36.910156v-27.515625c0-6.078125 4.925782-11.003907 11.003906-11.003907h14.898438c6.078125 0 11.007812 4.925782 11.007812 11.003907zm0 0"
                            fill="#fc3e81" />
                        <path
                            d="m512 72.453125v274.425781c0 12.148438-9.851562 22.011719-22.011719 22.011719h-467.976562c-12.160157 0-22.011719-9.863281-22.011719-22.011719v-274.425781c0-12.152344 9.851562-22.011719 22.011719-22.011719h467.976562c12.160157 0 22.011719 9.859375 22.011719 22.011719zm0 0"
                            fill="#9cc6db" />
                        <path
                            d="m408.203125 243.960938c0 51.660156-25.875 97.402343-65.355469 124.929687h-173.695312c-39.480469-27.527344-65.355469-73.269531-65.355469-124.929687 0-83.921876 68.28125-152.203126 152.203125-152.203126s152.203125 68.28125 152.203125 152.203126zm0 0"
                            fill="#84a1c0" />
                        <path
                            d="m463.25 118.894531h-51.300781c-5.691407 0-10.300781-4.613281-10.300781-10.300781v-15.195312c0-5.691407 4.609374-10.304688 10.300781-10.304688h51.300781c5.691406 0 10.304688 4.613281 10.304688 10.304688v15.195312c-.003907 5.6875-4.613282 10.300781-10.304688 10.300781zm0 0"
                            fill="#fc3e81" />
                        <path d="m0 118.898438h512v217.335937h-512zm0 0" fill="#618baa" />
                        <path
                            d="m408.203125 243.960938c0 34.65625-11.644531 66.652343-31.234375 92.273437h-241.9375c-19.589844-25.621094-31.234375-57.617187-31.234375-92.273437 0-51.75 25.964844-97.546876 65.542969-125.0625h173.320312c39.578125 27.515624 65.542969 73.3125 65.542969 125.0625zm0 0"
                            fill="#4e7693" />
                        <path
                            d="m420.269531 264.085938h-32.199219v-45.144532h32.199219c7.148438 0 12.945313 5.796875 12.945313 12.945313v19.253906c0 7.148437-5.796875 12.945313-12.945313 12.945313zm0 0"
                            fill="#38627c" />
                        <path
                            d="m394.992188 243.960938c0 76.761718-62.226563 138.992187-138.992188 138.992187s-138.992188-62.230469-138.992188-138.992187c0-76.765626 62.226563-138.996094 138.992188-138.996094s138.992188 62.230468 138.992188 138.996094zm0 0"
                            fill="#e3f4ff" />
                        <path
                            d="m365.078125 243.960938c0 60.242187-48.835937 109.078124-109.078125 109.078124s-109.078125-48.835937-109.078125-109.078124c0-60.246094 48.835937-109.082032 109.078125-109.082032s109.078125 48.835938 109.078125 109.082032zm0 0"
                            fill="#bddff4" />
                        <path
                            d="m352.230469 243.960938c0 53.144531-43.085938 96.226562-96.230469 96.226562s-96.230469-43.082031-96.230469-96.226562c0-53.148438 43.085938-96.230469 96.230469-96.230469s96.230469 43.082031 96.230469 96.230469zm0 0"
                            fill="#38627c" />
                        <g fill="#3fefef">
                            <path
                                d="m320.878906 243.960938c0 35.828124-29.046875 64.875-64.878906 64.875s-64.878906-29.046876-64.878906-64.875c0-35.832032 29.046875-64.878907 64.878906-64.878907s64.878906 29.046875 64.878906 64.878907zm0 0" />
                            <path
                                d="m99.96875 118.894531c0 11.949219-9.6875 21.632813-21.632812 21.632813-11.949219 0-21.636719-9.683594-21.636719-21.632813s9.6875-21.632812 21.636719-21.632812c11.945312 0 21.632812 9.683593 21.632812 21.632812zm0 0" />
                        </g>
                    </svg>
                    <p class="text-centered m-0">Click here to add images for this Product</p>
                </div>
                <div class="images p-1 d-none">

                </div>
                <input type="file" name="images" id="images_field" accept="image/*" onchange="fillImages(this)" multiple>
            </div>
            {% if form.non_field_errors %}
                <small class="">{{ form.non_field_errors.as_text }} </small>
            {% endif %}
            <div class="d-block mb-1">
                <label for="name_field" class="d-block">Name</label>
                <input type="text" name="name" id="name_field" maxlength="50" required>
            </div>
            <div class="d-block mb-1">
                <label for="descr_field" class="d-block">Description</label>
                <textarea name="description" id="descr_field" cols="30" rows="10" maxlength="1500"></textarea>
            </div>
            <div class="grid">
                <div class="d-block mb-1">
                    <label for="price_field" class="d-block">Price</label>
                    <input type="number" name="price_0" value="0.0" id="price_field" required>
                    <input type="hidden" name="price_1" value="KES">
                </div>
                <div class="d-block mb-1">
                    <label for="category_field" class="d-block">Category</label>
                    <select name="category" id="category_field" style="width:100%;">
                        <option value="" selected>Select a Category</option>
                        {% for category in categories %}
                          <option value="{{ category.id }}">{{ category.category }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="d-block mb-1">
                <label for="quantity_field" class="d-block">Quantity</label>
                <input type="number" name="quantity" id="quantity_field" min="0" value="0" required>
            </div>
            <div class="d-block mb-1">
                <label for="variant_field" class="d-block">Variant Information</label>
                <input type="text" name="variant_info" id="variant_field" maxlength="50" placeholder="What's unique about this product?">
            </div>
            {% csrf_token %} 
            <input type="submit" class="act-themed" value="ADD PRODUCT">
        </form>
    </div>
  </div>
{% endblock body_block %}

{% block script_block %}
  <script src="{% static 'js/tinymce/tinymce.min.js' %}"></script>
  <script>
    function clickInput() {
        var input = document.querySelector("input[type=file]");
        clickEvent = document.createEvent("MouseEvents");
        clickEvent.initEvent("click", true, true);
        clickEvent.synthetic = true;
        input.dispatchEvent(clickEvent);
    }

    function fillImages(input) {
        if (input.files && input.files.length > 0) {
            document.querySelector("#upload_images>.flex").classList.add("d-none");
            document.querySelector("#upload_images>.images").classList.remove("d-none");
            document.querySelector("#upload_images>.images").innerHTML = "";
            for (const image in input.files) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var image = document.createElement("img");
                    image.classList.add("upload-image");
                    image.setAttribute("src", e.target.result);
                    document.querySelector("#upload_images>.images").appendChild(image);
                }
                reader.readAsDataURL(input.files[image]);
            }
        } else {
            document.querySelector("#upload_images>.flex").classList.remove("d-none");
            document.querySelector("#upload_images>.images").classList.add("d-none");
        }
    }
    
    tinyMCE.init({
        selector: "#descr_field",
        menubar: "edit view format",
    })
  </script>
{% endblock script_block %}