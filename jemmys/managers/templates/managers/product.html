{% extends "base_mgrs.html" %}
{% load staticfiles %}

{% block title_block %}
    {{ product.name }} | Jemmy's Collection
{% endblock title_block %}

{% block float_top_block %}
<div id="update-product" class="flex flex-xy-center dismissed">
    <div class="card" style="background:#fff; overflow: auto; max-height: 80vh;">
        <div class="flex" style="justify-content:space-between;">
            <h4 class="m-0">Update product</h4>
            <button id="dismiss-update-prod" target="update-product">
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                    y="0px" viewBox="0 0 47.971 47.971" style="height:1.35em" xml:space="preserve">
                    <g>
                        <path d="M28.228,23.986L47.092,5.122c1.172-1.171,1.172-3.071,0-4.242c-1.172-1.172-3.07-1.172-4.242,0L23.986,19.744L5.121,0.88
                                                            c-1.172-1.172-3.07-1.172-4.242,0c-1.172,1.171-1.172,3.071,0,4.242l18.865,18.864L0.879,42.85c-1.172,1.171-1.172,3.071,0,4.242
                                                            C1.465,47.677,2.233,47.97,3,47.97s1.535-0.293,2.121-0.879l18.865-18.864L42.85,47.091c0.586,0.586,1.354,0.879,2.121,0.879
                                                            s1.535-0.293,2.121-0.879c1.172-1.171,1.172-3.071,0-4.242L28.228,23.986z" />
                    </g>
                </svg>
            </button>
        </div>
        <hr>
        
        <form method="post" action="{% url 'managers:update-product' product.slug %}" enctype="multipart/form-data" style="padding-bottom:1em;"> 
        {% if product.variant_of %}
            <div class="d-block mb-1">
                <label for="name_field" class="d-block">Name</label>
                <input type="text" name="name" id="name_field" value="{{ product.name }}" maxlength="50" required>
            </div>
            <div class="d-block mb-1">
                <label for="quantity_field" class="d-block">Quantity</label>
                <input type="number" name="quantity" id="quantity_field" min="0" value="{{ product.quantity }}" required>
            </div>
            <div class="d-block mb-1">
                <label for="variant_of_field" class="d-block">Variant Of</label>
                <select name="variant_of" id="variant_of_field" style="width:100%;">
                    {% for variant_of_product in variant_of_products %}
                        {% if variant_of_product == product.variant_of %}
                            <option value="{{ variant_of_product.id }}" selected>{{ variant_of_product.name }}</option>
                        {% else %}
                            <option value="{{ variant_of_product.id }}">{{ variant_of_product.name }}</option>
                        {% endif %}
                        
                    {% endfor %}
                </select>
            </div>
            <div class="d-block mb-1">
                <label for="variant_field" class="d-block">Variant Information</label>
                <input type="text" name="variant_info" id="variant_field" maxlength="50" {% if product.variant_info %}
                value="{{ product.variant_info }}"
                {% endif %} placeholder="What's unique about this product?">
            </div>
            <input type="hidden" name="price_0" value="{{ product.price|floatformat }}">
            <input type="hidden" name="price_1" value="KES">
            <input type="hidden" name="category" value="{{ product.category.id }}">
            {% csrf_token %} 
            <input type="submit" class="act-themed" value="CHANGE">
        {% else %}
            <div class="d-block mb-1">
                <label for="name_field" class="d-block">Name</label>
                <input type="text" name="name" id="name_field" value="{{ product.name }}" maxlength="50" required>
            </div>
            <div class="d-block mb-1">
                <label for="descr_field" class="d-block">Description</label>
                <textarea name="description" id="descr_field" cols="30" rows="10" maxlength="1500">
                    {{ product.description|safe }}
                </textarea>
            </div>
            <div class="grid">
                <div class="d-block mb-1">
                    <label for="price_field" class="d-block">Price</label>
                    <input type="number" name="price_0" value="{{ product.price|floatformat }}" id="price_field" required>
                    <input type="hidden" name="price_1" value="KES">
                </div>
                <div class="d-block mb-1">
                    <label for="category_field" class="d-block">Category</label>
                    <select name="category" id="category_field" style="width:100%;">
                        {% for category in categories %}
                            {% if category == product.category %}
                                <option value="{{ category.id }}" selected>{{ category.category }}</option>
                            {% else %}
                                <option value="{{ category.id }}">{{ category.category }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="d-block mb-1">
                <label for="quantity_field" class="d-block">Quantity</label>
                <input type="number" name="quantity" id="quantity_field" min="0" value="{{ product.quantity }}" required>
            </div>
            <div class="d-block mb-1">
                <label for="variant_field" class="d-block">Variant Information</label>
                <input type="text" name="variant_info" id="variant_field" maxlength="50" {% if product.variant_info %}
                value="{{ product.variant_info }}"
                {% endif %} placeholder="What's unique about this product?">
            </div>
            {% csrf_token %} 
            <input type="submit" class="act-themed" value="CHANGE">
            
        {% endif %}
        </form>
            
    </div>
</div>
{% endblock float_top_block %}

{% block body_block %}

<div style="margin: 0 5%;">
    <div class="flex mb-1" style="justify-content:left;">
        <a href="{% url 'managers:products' %}" class="flex" style="align-items:center;">
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                y="0px" viewBox="0 0 477.175 477.175" style="height: 1.25rem;" xml:space="preserve">
                <g>
                    <path d="M145.188,238.575l215.5-215.5c5.3-5.3,5.3-13.8,0-19.1s-13.8-5.3-19.1,0l-225.1,225.1c-5.3,5.3-5.3,13.8,0,19.1l225.1,225
                                c2.6,2.6,6.1,4,9.5,4s6.9-1.3,9.5-4c5.3-5.3,5.3-13.8,0-19.1L145.188,238.575z" />
                </g>
            </svg>
            All Products
        </a> 
    </div>
    <div id="product">
        {% if product.variant_of %}
        <div class="flex" style="justify-content:left;">
            <a href="{% url 'managers:product' product.variant_of.slug %}"> 
                <button class="act-themed">GO BACK</button>
            </a>
        </div>
        {% endif %}
        <h1 class="m-0">{{ product.name }}</h1>

        <div class="grid">
            <div id="images" class="flex">
                {% for image in product.images.all %}
                  <div class="image">
                      <img src="{{ image.photo.url }}" alt="{{ product.name }}'s image {{ forloop.counter }}">
                  </div>
                {% empty %}
                    <div class="flex flex-xy-center" onclick="clickInput()">
                        <svg viewBox="0 -65 512 512" style="height:5em;" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="m428.242188 34.117188h-58.921876v-23.109376c0-6.078124 4.929688-11.007812 11.007813-11.007812h36.910156c6.078125 0 11.003907 4.929688 11.003907 11.007812zm0 0"
                                fill="#618baa" />
                            <path
                                d="m151.441406 23.664062v38.519532h-102.949218v-38.519532c0-6.074218 4.933593-11.007812 11.007812-11.007812h80.9375c6.074219 0 11.003906 4.933594 11.003906 11.007812zm0 0"
                                fill="#e3f4ff" />
                            <path d="m48.492188 37.234375h102.949218v24.949219h-102.949218zm0 0" fill="#bddff4" />
                            <path
                                d="m450.257812 62.183594h-102.949218v-23.113282c0-6.078124 4.929687-11.003906 11.007812-11.003906h80.933594c6.078125 0 11.007812 4.925782 11.007812 11.003906zm0 0"
                                fill="#38627c" />
                            <path
                                d="m221.882812 62.183594h-36.910156v-27.515625c0-6.078125 4.925782-11.003907 11.003906-11.003907h14.898438c6.078125 0 11.007812 4.925782 11.007812 11.003907zm0 0"
                                fill="#fc3e81" />
                            <path
                                d="m512 72.453125v274.425781c0 12.148438-9.851562 22.011719-22.011719 22.011719h-467.976562c-12.160157 0-22.011719-9.863281-22.011719-22.011719v-274.425781c0-12.152344 9.851562-22.011719 22.011719-22.011719h467.976562c12.160157 0 22.011719 9.859375 22.011719 22.011719zm0 0"
                                fill="#9cc6db" />
                            <path
                                d="m408.203125 243.960938c0 51.660156-25.875 97.402343-65.355469 124.929687h-173.695312c-39.480469-27.527344-65.355469-73.269531-65.355469-124.929687 0-83.921876 68.28125-152.203126 152.203125-152.203126s152.203125 68.28125 152.203125 152.203126zm0 0"
                                fill="#84a1c0" />
                            <path
                                d="m463.25 118.894531h-51.300781c-5.691407 0-10.300781-4.613281-10.300781-10.300781v-15.195312c0-5.691407 4.609374-10.304688 10.300781-10.304688h51.300781c5.691406 0 10.304688 4.613281 10.304688 10.304688v15.195312c-.003907 5.6875-4.613282 10.300781-10.304688 10.300781zm0 0"
                                fill="#fc3e81" />
                            <path d="m0 118.898438h512v217.335937h-512zm0 0" fill="#618baa" />
                            <path
                                d="m408.203125 243.960938c0 34.65625-11.644531 66.652343-31.234375 92.273437h-241.9375c-19.589844-25.621094-31.234375-57.617187-31.234375-92.273437 0-51.75 25.964844-97.546876 65.542969-125.0625h173.320312c39.578125 27.515624 65.542969 73.3125 65.542969 125.0625zm0 0"
                                fill="#4e7693" />
                            <path
                                d="m420.269531 264.085938h-32.199219v-45.144532h32.199219c7.148438 0 12.945313 5.796875 12.945313 12.945313v19.253906c0 7.148437-5.796875 12.945313-12.945313 12.945313zm0 0"
                                fill="#38627c" />
                            <path
                                d="m394.992188 243.960938c0 76.761718-62.226563 138.992187-138.992188 138.992187s-138.992188-62.230469-138.992188-138.992187c0-76.765626 62.226563-138.996094 138.992188-138.996094s138.992188 62.230468 138.992188 138.996094zm0 0"
                                fill="#e3f4ff" />
                            <path
                                d="m365.078125 243.960938c0 60.242187-48.835937 109.078124-109.078125 109.078124s-109.078125-48.835937-109.078125-109.078124c0-60.246094 48.835937-109.082032 109.078125-109.082032s109.078125 48.835938 109.078125 109.082032zm0 0"
                                fill="#bddff4" />
                            <path
                                d="m352.230469 243.960938c0 53.144531-43.085938 96.226562-96.230469 96.226562s-96.230469-43.082031-96.230469-96.226562c0-53.148438 43.085938-96.230469 96.230469-96.230469s96.230469 43.082031 96.230469 96.230469zm0 0"
                                fill="#38627c" />
                            <g fill="#3fefef">
                                <path
                                    d="m320.878906 243.960938c0 35.828124-29.046875 64.875-64.878906 64.875s-64.878906-29.046876-64.878906-64.875c0-35.832032 29.046875-64.878907 64.878906-64.878907s64.878906 29.046875 64.878906 64.878907zm0 0" />
                                <path
                                    d="m99.96875 118.894531c0 11.949219-9.6875 21.632813-21.632812 21.632813-11.949219 0-21.636719-9.683594-21.636719-21.632813s9.6875-21.632812 21.636719-21.632812c11.945312 0 21.632812 9.683593 21.632812 21.632812zm0 0" />
                            </g>
                        </svg>
                        <p class="text-centered m-0">This product has no images. Click here to add images for this Product</p>
                    </div>
                    <div class="images p-1 d-none">
                    
                    </div>
                    <input type="file" name="images" id="images_field" accept="image/*" onchange="fillImages(this)" multiple>
                {% endfor %}
            </div>
            <div id="details">
                
                {% if product.description %}                        
                    <h4 class="m-0">Description</h4>
                    <p class="mt-d5">{{ product.description|safe }}</p>
                {% endif %}

                <h4 class="m-0">Quantity</h4>
                <p class="mt-d5">{{ product.quantity }}</p>

                <h4 class="m-0">Price</h4>
                <p class="mt-d5">{{ product.price }}</p>
                
                {% if product.variant_of %}
                    <h4 class="m-0">Variant Of</h4>
                    <a href="{% url 'managers:product' product.variant_of.slug %}"><p class="mt-d5">{{ product.variant_of.name }}</p></a>
                {% endif %}
                    

                {% if product.variant_info %}
                    <h4 class="m-0">Variant Information</h4>
                    <p class="mt-d5">{{ product.variant_info }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <button class="act-themed mb-1" id="show-update-prod" target="update-product">CHANGE DETAILS</button>
    
    {% if product.variant_of == None %}
        <div id="variants">
            <h3>Variants</h3>
            <hr>
            <div class="card product-list">
                {% for variant in product.variants.all %}
                <div class="grid product-list-item">
                    <img src="{{ variant.images.all.0.photo.url }}" style="width: 5em;" alt="{{ variant.name }}'s image">
                    <div class="product-details">
                    <span class="m-0">{{ variant.name }}</span>
                    <table>
                        <tbody>
                            <tr>
                                <td>QTY: <span class="bold">{{ variant.quantity }}</span></td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                    <div class="link flex">
                        <a href="{% url 'managers:product' variant.slug %}"> 
                            <button class="act-themed">VIEW</button>
                        </a>
                    </div>
                </div>
                
                {% if forloop.last %}
                <div class="flex" style="justify-content:right;">
                    <button id="show-add-var" class="act-themed" target="add-variant">ADD VARIANT</button>
                </div>
                {% endif %}
                    
                {% empty %}
                    <p class="text-centered">This product has no variants. <a id="show-add-var" target="add-variant" style="cursor:pointer;">Click here</a> to add one</p>
                {% endfor %}
            </div>
                
        </div>
    {% endif %}
        
</div>

{% if messages %}
    {% for message in messages %}
        {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
        <div class="text-centered p-d5 st-s message bold">
            {{ message }}
        </div>
        {% endif %}
    {% endfor %}
{% endif %}

{% endblock body_block %}

{% block float_bottom_block %}
<div id="add-variant" class="flex flex-xy-center dismissed">
    <div class="card" style="background:#fff; overflow: auto; max-height: 80vh;">
        <div class="flex" style="justify-content:space-between;">
                <h4 class="m-0">Add a variant</h4>
                <button id="dismiss-add-var" target="add-variant">
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                        y="0px" viewBox="0 0 47.971 47.971" style="height:1.35em" xml:space="preserve">
                        <g>
                            <path d="M28.228,23.986L47.092,5.122c1.172-1.171,1.172-3.071,0-4.242c-1.172-1.172-3.07-1.172-4.242,0L23.986,19.744L5.121,0.88
                                                                c-1.172-1.172-3.07-1.172-4.242,0c-1.172,1.171-1.172,3.071,0,4.242l18.865,18.864L0.879,42.85c-1.172,1.171-1.172,3.071,0,4.242
                                                                C1.465,47.677,2.233,47.97,3,47.97s1.535-0.293,2.121-0.879l18.865-18.864L42.85,47.091c0.586,0.586,1.354,0.879,2.121,0.879
                                                                s1.535-0.293,2.121-0.879c1.172-1.171,1.172-3.071,0-4.242L28.228,23.986z" />
                        </g>
                    </svg>
                </button>
            </div>
            <hr>
            <form method="post" enctype="multipart/form-data" action="{% url 'managers:new-variant' %}"> 
                <div id="upload_images" class="mb-1">
                    <div class="flex flex-xy-center" onclick="clickInput()">
                        <svg viewBox="0 -65 512 512" style="height:5em;" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="m428.242188 34.117188h-58.921876v-23.109376c0-6.078124 4.929688-11.007812 11.007813-11.007812h36.910156c6.078125 0 11.003907 4.929688 11.003907 11.007812zm0 0"
                                fill="#618baa" />
                            <path
                                d="m151.441406 23.664062v38.519532h-102.949218v-38.519532c0-6.074218 4.933593-11.007812 11.007812-11.007812h80.9375c6.074219 0 11.003906 4.933594 11.003906 11.007812zm0 0"
                                fill="#e3f4ff" />
                            <path d="m48.492188 37.234375h102.949218v24.949219h-102.949218zm0 0" fill="#bddff4" />
                            <path
                                d="m450.257812 62.183594h-102.949218v-23.113282c0-6.078124 4.929687-11.003906 11.007812-11.003906h80.933594c6.078125 0 11.007812 4.925782 11.007812 11.003906zm0 0"
                                fill="#38627c" />
                            <path
                                d="m221.882812 62.183594h-36.910156v-27.515625c0-6.078125 4.925782-11.003907 11.003906-11.003907h14.898438c6.078125 0 11.007812 4.925782 11.007812 11.003907zm0 0"
                                fill="#fc3e81" />
                            <path
                                d="m512 72.453125v274.425781c0 12.148438-9.851562 22.011719-22.011719 22.011719h-467.976562c-12.160157 0-22.011719-9.863281-22.011719-22.011719v-274.425781c0-12.152344 9.851562-22.011719 22.011719-22.011719h467.976562c12.160157 0 22.011719 9.859375 22.011719 22.011719zm0 0"
                                fill="#9cc6db" />
                            <path
                                d="m408.203125 243.960938c0 51.660156-25.875 97.402343-65.355469 124.929687h-173.695312c-39.480469-27.527344-65.355469-73.269531-65.355469-124.929687 0-83.921876 68.28125-152.203126 152.203125-152.203126s152.203125 68.28125 152.203125 152.203126zm0 0"
                                fill="#84a1c0" />
                            <path
                                d="m463.25 118.894531h-51.300781c-5.691407 0-10.300781-4.613281-10.300781-10.300781v-15.195312c0-5.691407 4.609374-10.304688 10.300781-10.304688h51.300781c5.691406 0 10.304688 4.613281 10.304688 10.304688v15.195312c-.003907 5.6875-4.613282 10.300781-10.304688 10.300781zm0 0"
                                fill="#fc3e81" />
                            <path d="m0 118.898438h512v217.335937h-512zm0 0" fill="#618baa" />
                            <path
                                d="m408.203125 243.960938c0 34.65625-11.644531 66.652343-31.234375 92.273437h-241.9375c-19.589844-25.621094-31.234375-57.617187-31.234375-92.273437 0-51.75 25.964844-97.546876 65.542969-125.0625h173.320312c39.578125 27.515624 65.542969 73.3125 65.542969 125.0625zm0 0"
                                fill="#4e7693" />
                            <path
                                d="m420.269531 264.085938h-32.199219v-45.144532h32.199219c7.148438 0 12.945313 5.796875 12.945313 12.945313v19.253906c0 7.148437-5.796875 12.945313-12.945313 12.945313zm0 0"
                                fill="#38627c" />
                            <path
                                d="m394.992188 243.960938c0 76.761718-62.226563 138.992187-138.992188 138.992187s-138.992188-62.230469-138.992188-138.992187c0-76.765626 62.226563-138.996094 138.992188-138.996094s138.992188 62.230468 138.992188 138.996094zm0 0"
                                fill="#e3f4ff" />
                            <path
                                d="m365.078125 243.960938c0 60.242187-48.835937 109.078124-109.078125 109.078124s-109.078125-48.835937-109.078125-109.078124c0-60.246094 48.835937-109.082032 109.078125-109.082032s109.078125 48.835938 109.078125 109.082032zm0 0"
                                fill="#bddff4" />
                            <path
                                d="m352.230469 243.960938c0 53.144531-43.085938 96.226562-96.230469 96.226562s-96.230469-43.082031-96.230469-96.226562c0-53.148438 43.085938-96.230469 96.230469-96.230469s96.230469 43.082031 96.230469 96.230469zm0 0"
                                fill="#38627c" />
                            <g fill="#3fefef">
                                <path
                                    d="m320.878906 243.960938c0 35.828124-29.046875 64.875-64.878906 64.875s-64.878906-29.046876-64.878906-64.875c0-35.832032 29.046875-64.878907 64.878906-64.878907s64.878906 29.046875 64.878906 64.878907zm0 0" />
                                <path
                                    d="m99.96875 118.894531c0 11.949219-9.6875 21.632813-21.632812 21.632813-11.949219 0-21.636719-9.683594-21.636719-21.632813s9.6875-21.632812 21.636719-21.632812c11.945312 0 21.632812 9.683593 21.632812 21.632812zm0 0" />
                            </g>
                        </svg>
                        <p class="text-centered m-0">Click here to add images for this Product</p>
                    </div>
                    <div class="images p-1 d-none">
    
                    </div>
                    <input type="file" name="images" id="images_field" accept="image/*" onchange="fillImages(this)" multiple>
                </div>
                <div class="d-block mb-1">
                    <label for="name_field" class="d-block">Name</label>
                    <input type="text" name="name" id="name_field" maxlength="50" required>
                </div>
                <div class="d-block mb-1">
                    <label for="quantity_field" class="d-block">Quantity</label>
                    <input type="number" name="quantity" id="quantity_field" min="0" value="0" required>
                </div>
                <div class="d-block mb-1">
                    <label for="variant_field" class="d-block">Variant Information</label>
                    <input type="text" name="variant_info" id="variant_field" maxlength="50" placeholder="What's unique about this product?">
                </div>
                <input type="hidden" name="variant_of" value="{{ product.id }}">
                <input type="hidden" name="action" value="add">
                {% csrf_token %} 
                <input type="submit" class="act-themed" value="ADD VARIANT">
            </form>
    </div>
</div>
{% endblock float_bottom_block %}

{% block script_block %}
<script src="{% static 'js/tinymce/tinymce.min.js' %}"></script>
<script>
    function fillImages(input) {
        if (input.files && input.files.length > 0) {
            document.querySelector("#upload_images>.flex").classList.add("d-none");
            document.querySelector("#upload_images>.images").classList.remove("d-none");
            document.querySelector("#upload_images>.images").innerHTML = "";
            for (const image in input.files) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var image = document.createElement("img");
                    image.classList.add("upload-image");
                    image.setAttribute("src", e.target.result);
                    document.querySelector("#upload_images>.images").appendChild(image);
                }
                reader.readAsDataURL(input.files[image]);
            }
        } else {
            document.querySelector("#upload_images>.flex").classList.remove("d-none");
            document.querySelector("#upload_images>.images").classList.add("d-none");
        }
    }
    document.querySelector("#show-update-prod").addEventListener("click", toggleSide);
    document.querySelector("#dismiss-update-prod").addEventListener("click", toggleSide);
    var addVariant = document.querySelector("#show-add-var");
    if (addVariant) {
        addVariant.addEventListener("click", toggleSide);
    }
    document.querySelector("#dismiss-add-var").addEventListener("click", toggleSide);
    tinyMCE.init({
        selector: "#descr_field",
        menubar: "edit view format",
    });
    setTimeout(function() {
        var messages = document.querySelectorAll(".message");
        messages.forEach(function(message){
            message.remove();
        });
    }, 3000);
</script>
{% endblock script_block %}
    